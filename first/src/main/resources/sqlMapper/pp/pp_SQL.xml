<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="pp">
	<!--
	==================================================================
	  * 설명		: PP 목록 조회(MCP/SCP)
	  *	기능		: SELECT
	  *	TABLE	: TCM_PP
	==================================================================
	-->
	<select id="lists" parameterType="hashmap" resultType="hashmap" >
		SELECT /* pp.lists */
		       --LPAD(' ',(LEVEL-1)*2, ' ') || A.KN_CUST AS KN_CUST
		       A.KN_CUST
		      ,A.CORPID
		      ,A.PARENT_CP
		      ,A.CP_KIND
		  FROM TCM_PP A
		 START WITH A.CP_KIND = 'CPDS0100'
	   CONNECT BY PRIOR A.CORPID = A.PARENT_CP
		 ORDER SIBLINGS BY A.CORPID 
	</select>
	
	<select id="list" parameterType="hashmap" resultType="hashmap" >
		<include refid="common.pagingPre"/>
		SELECT /* pp.list */
		       ROW_NUMBER() OVER (ORDER BY A.CORPID DESC) RNUM
		      ,A.CORPID
		      ,A.CD_CUST
		      ,A.KN_CUST
		      ,A.NO_TAX
		      ,A.KN_TRADE
		      ,A.KN_PRESIDENT
		      ,A.KN_BUSINESSCOND
		      ,A.KN_ITEM
		      ,A.CL_CUST
		      ,A.YN_LEGAL
		      ,CASE WHEN A.YN_LEGAL = 'Y' THEN '예' ELSE '아니오' END YN_LEGAL_NM 
		      ,A.NO_POST
		      ,A.KN_ADDRESS||' '||A.KN_ADDRESS2 AS KN_ADDRESS
		      ,A.NO_TEL
		      ,A.YN_USE
		      ,CASE WHEN A.YN_USE = 'Y' THEN '예' ELSE '아니오' END YN_USE_NM 
		      ,A.NO_FAX
		      ,A.YN_LEGAL
		      ,A.KN_CUSTEMP
		      ,A.KN_CUSTTEL
		      ,A.E_MAIL
		      ,A.CP_KIND
		      ,CD.CODE_NAME AS CP_KIND_NM
		      ,A.PARENT_CP
		      ,MCP.KN_CUST AS MCP_NM
	  	  FROM TCM_PP A
			  ,(SELECT CORPID, KN_CUST, CP_KIND FROM TCM_PP WHERE CP_KIND = 'CPDS0100' ) B
              ,(SELECT CODE, CODE_NAME FROM JWORK_CODE WHERE CODE_GROUP = 'CPDS' ) C
         WHERE 1=1
           AND A.PARENT_CP = B.CORPID(+)
           AND A.CP_KIND = C.CODE(+)   
        <if test="s_cd_cust != null and s_cd_cust != ''">
	       AND A.CORPID LIKE '%' || #{s_cd_cust} || '%'
	    </if>
	    <if test="search_kn_cust != null and search_kn_cust != ''">
	       AND A.KN_CUST LIKE '%' || #{s_kn_cust} || '%'
	    </if>	
		 ORDER BY A.CORPID DESC	
		<include refid="common.pagingPost"/>  
	</select>

	<!--
	==================================================================
	  * 설명		: PP 목록 조회(MCP/SCP)
	  *	기능		: SELECT
	  *	TABLE	: TCM_PP
	==================================================================
	-->
	<select id="mcp_detail" parameterType="hashmap" resultType="hashmap" >	
		SELECT /* pp.mcp_detail */
		       A.CORPID
		      ,A.KN_CUST
		      ,A.NO_TAX
		      ,A.KN_TRADE
		      ,A.KN_PRESIDENT
		      ,A.KN_BUSINESSCOND
		      ,A.KN_ITEM
		      ,A.CL_CUST
		      ,A.YN_LEGAL
		      ,CASE WHEN A.YN_LEGAL = 'Y' THEN '예' ELSE '아니오' END YN_LEGAL_NM 
		      ,A.NO_POST
		      ,A.KN_ADDRESS||' '||A.KN_ADDRESS2 AS KN_ADDRESS
		      ,A.NO_TEL
		      ,A.YN_USE
		      ,CASE WHEN A.YN_USE = 'Y' THEN '예' ELSE '아니오' END YN_USE_NM 
		      ,A.NO_FAX
		      ,A.YN_LEGAL
		      ,A.KN_CUSTEMP
		      ,A.KN_CUSTTEL
		      ,A.E_MAIL
		      ,A.CP_KIND
	  	  FROM TCM_PP A
         WHERE 1=1
           AND A.CP_KIND = #{s_cp_kind}
	 	<if test="s_cd_cust != null and s_cd_cust != ''">
	       AND A.CORPID LIKE '%' || #{s_cd_cust} || '%'
	    </if>
	    <if test="s_kn_cust != null and s_kn_cust != ''">
	       AND UPPER(A.KN_CUST )LIKE '%' || UPPER( #{s_kn_cust} ) || '%'
	    </if>
		 ORDER BY A.CORPID
	</select>
	
	<!--
	==================================================================
	  * 설명		: PP의 채널목록 조회
	  *	기능		: SELECT
	  *	TABLE	: TCM_CHANNEL
	==================================================================
	-->
	<select id="pp_channel_list" parameterType="java.util.Map" resultType="hashmap" >	
		SELECT /* pp_channel_list */
			   TC.CH_CD
			  ,TC.CH_NM
			  ,TC.CH_KIND_CD
			  ,CH_KIND_NM
			  ,TC.BROAD_KIND_CD
			  ,BROAD_KIND_NM
			  ,TC.CH_NO
			  ,TC.HD_YN
			  ,CASE WHEN TC.HD_YN = 'Y' THEN '예' ELSE '아니오' END AS HD_YN_NM
			  ,TO_CHAR(TO_DATE(TC.INS_DT, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') AS INS_DT
		  FROM TCM_CHANNEL TC
			 ,(SELECT CODE, CODE_NAME AS CH_KIND_NM
			     FROM JWORK_CODE
				WHERE CODE_GROUP 	= 'CPCS'
				  AND USE_YN 		= 'Y'   ) CD1
			 ,(SELECT CODE, CODE_NAME AS BROAD_KIND_NM
			     FROM JWORK_CODE
				WHERE CODE_GROUP 	= 'CPSE'
				  AND USE_YN 		= 'Y'   ) CD2	  
		 WHERE TC.DEL_YN 		= 'N'
		   AND TC.CH_KIND_CD	= CD1.CODE(+)
		   AND TC.BROAD_KIND_CD	= CD2.CODE(+)
	<choose>
		<when test="S_CP_KIND == 'CPDS0100'">			  			   
	       AND TC.PP_CD 		=  #{pp_cd}
		</when>
		<when test="S_CP_KIND == 'CPDS0200'">			  			   
		   AND TC.SCP_CD 		=  #{pp_cd}
		</when>
		<otherwise></otherwise>
	</choose>
	</select>
	
	<insert id="insert" parameterType="hashmap" useGeneratedKeys="true" keyProperty="IDX">
		/* movie.insert */
		<selectKey keyProperty="IDX" resultType="string" order="BEFORE">
			SELECT SEQ_TB_BOARD_IDX.NEXTVAL FROM DUAL
		</selectKey>
		<![CDATA[
			INSERT INTO TB_BOARD
			(
				IDX,
			    TITLE, 
			    CONTENTS, 
			    HIT_CNT, 
			    DEL_GB, 
			    CREA_DTM, 
			    CREA_ID
			)
			VALUES
			(
				#{IDX}, 
				#{TITLE},
				#{CONTENTS},
			    0, 
			    'N', 
			    SYSDATE, 
			    'Admin'
			)
		]]>
	</insert>
	
	<update id="update" parameterType="hashmap">
		/* movie.update */
		UPDATE TCM_MOVIE 
		   SET MOVIE_NM = #{movie_nm_detail}
	     WHERE MOVIE_CD = #{movie_cd_detail}
	</update>
	
	<update id="delete" parameterType="hashmap">
		/* movie.delete */
		UPDATE TCM_MOVIE 
		   SET DEL_YN = 'Y'
	     WHERE MOVIE_CD = #{movie_cd_detail}
	</update>
	
</mapper>